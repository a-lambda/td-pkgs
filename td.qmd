---
title: "TD développement de package"
---

## Introduction

*Nous allons reprendre votre package `{squirrels}` qui sert de fil rouge tout au long de la formation.*

*Utlisez la table des matières de ce document pour naviguer plus facilement dans les différentes sections.*

*Les solutions de ce TD vous seront fournies dans `/shared` à la fin de chaque étape, sous la forme de fichiers `flat_*.Rmd` et `dev_history.Rmd`.*

## Test unitaires

### Tester la fonction `get_message_fur_color()`

- Ajoutez des vérifications à votre fonction `get_message_fur_color()`

Pour le moment, vous vous êtes seulement assuré.e que la fonction renvoyait bien `"We will focus on Cinnamon squirrels"` lorsqu’on utilisait `get_message_fur_color(primary_fur_color = "Cinnamon")`. Mais vous pouvez ajouter des vérifications supplémentaires.

- Regonflez votre package avec ces nouveaux tests unitaires

- Observez la sortie de la commande suivante :

```{r}
#| label: devtools_test
#| eval: false

devtools::test()

```

### Ajouter et tester la fonction `check_primary_color_is_ok()`

- Ajoutez un nouveau fichier flat dédié à la vérification des données

```{r}
#| label: add_flat_template
#| eval: false

fusen::add_flat_template(template  = "additional",
                         flat_name = "check_data")

```

- Définissez un nouveau nom pour la future vignette (dans le chunk d’inflate)

```{r}
#| label: inflate
#| eval: false

fusen::inflate(flat_file     = "dev/flat_check_data.Rmd", 
               vignette_name = "Check data")

```

- Intégrez-y la fonction `check_primary_color_is_ok()`

```{r}
#| label: add_function_check_primary_color_is_ok
#| eval: false

#' Check the values of primary fur color
#'
#' @param string Character. A vector with the primary fur color.
#'
#' @return Boolean. TRUE if all colors are correct.
#' @export
#'
#' @examples
check_primary_color_is_ok <- function(string) {
  all_colors_OK <- all(
    string %in% c("Gray", "Cinnamon", "Black", NA)
  )
  return(all_colors_OK)
}

```

- Modifiez cette fonction `check_primary_color_is_ok()` de telle manière à ce qu’elle renvoie une erreur si le vecteur n’est pas OK (le message d’erreur doit être explicite)

- N'oubliez pas les exemples et les tests

### Vérifier le package

- Votre package doit retourner 0 errors 0 warnings 0 notes

- Vérifiez que votre package peut s’installer sans encombres

```{r}
#| label: build_and_install_local
#| eval: false

devtools::build(vignettes = TRUE) # construit le package au format tar.gz
remotes::install_local(path = "~/squirrels_0.0.0.9000.tar.gz") # installe le package depuis le format tar.gz

```

> **Est-ce que les fonctions `get_message_fur_color()` et `check_primary_color_is_ok()` sont accessibles ?**

## Documentation du package

- Construisez le site web pkgdown

- Ajoutez un README qui explique en quoi consiste ce package dédié aux écureuils

*Vous pouvez vous inspirer de celui de [{fusen}](https://github.com/ThinkR-open/fusen/blob/main/README.Rmd)^[https://github.com/ThinkR-open/fusen/blob/main/README.Rmd], et y intégrer cet hex si vous le souhaitez (disponible dans le dossier `data` de bakacode) :*

![](images/squirrels_hex.png){ width="25%" }

- Ajoutez un Code of Conduct

- Ajoutez un fichier NEWS

- Construisez de nouveau le site web pkgdown

- Construisez le rapport de coverage

> **Votre package doit retourner 0 errors 0 warnings 0 notes**

## Et si on recommençait tout depuis le début ?

- Créez un package `{squirrels2}` qui contient tous les éléments vus jusqu’ici. Les fonctions (avec exemples reproductibles et tests), la documentation, etc.

> **Votre package doit retourner 0 errors 0 warnings 0 notes**

> **Pour vous aider vous pouvez d’ores et déjà suivre la procédure condensée que vous trouverez dans** `docs/procedure_package_fusen.html`

## Données

### Données accessibles à l'utilisateur final

- Créez un jeu de données `data_act_squirrels` qui sera accessible à l’utilisateur avec `data(data_act_squirrels)`

  - Utilisez le fichier `nyc_squirrels_act_sample.csv` (présent dans votre dossier `data` de bakacode)

  - Gardez uniquement 15 lignes de ce jeu de données
  
  - Documentez ce jeu de données et de mettez la documentation à jour avec `attachment::att_amend_desc()`
  
  - Installez votre package, vérifiez que `data(data_act_squirrels)` et `?data_act_squirrels` fonctionnent correctement
  
### Données stockées dans `inst/`

- Intégrez le fichier `nyc_squirrels_sample.csv` dans `inst/` (présent dans votre dossier `data` de bakacode)

- Dans le fichier flat `flat_check_data.Rmd`, créez une fonction `check_squirrel_data_integrity()` qui prend comme input un jeu de données comme celui-ci et vérifie son intégrité :

  - La fonction vérifie que les données contiennent une colonne `primary_fur_color`, et cette colonne ne doit contenir que des couleurs autorisées (voir votre fonction `check_primary_color_is_ok()`)
  
  - Arrêter la fonction si ce n’est pas le cas
  
  - Retourner un message si tout est correct
  
- Créez un exemple reproductible en utilisant le jeu de données enregistré dans `inst/` avec `system.file()`

  - Pensez que vous pouvez simuler l’installation des données avec `pkgload::load_all()`
  
- Créez des tests unitaires avec des exemples où la fonction doit échouer

> **Votre package doit retourner 0 errors 0 warnings 0 notes**

## Check

- Relancez le check de votre package et assurez-vous qu’il renvoie 0 errors 0 warnings 0 notes

- Si ce n’est pas le cas, prenez du temps pour corriger les problèmes


